<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Example 1: Calculating a friction tensor from FHI-aims data: CO on Cu(100) &mdash; coolvib  documentation</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="coolvib  documentation" href="index.html" />
    <link rel="up" title="Tutorial" href="tutorial.html" />
    <link rel="next" title="Example 2: Calculating the lifetime along a given mode: CO on Pd(111)" href="example2.html" />
    <link rel="prev" title="Tutorial" href="tutorial.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">coolvib  documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="tutorial.html" title="Tutorial"
             accesskey="P">previous</a> |
          <a href="example2.html" title="Example 2: Calculating the lifetime along a given mode: CO on Pd(111)"
             accesskey="N">next</a> |
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="module-examples.example1"></span><div class="section" id="example-1-calculating-a-friction-tensor-from-fhi-aims-data-co-on-cu-100">
<h1>Example 1: Calculating a friction tensor from FHI-aims data: CO on Cu(100)<a class="headerlink" href="#example-1-calculating-a-friction-tensor-from-fhi-aims-data-co-on-cu-100" title="Permalink to this headline">¶</a></h1>
<p>In this example we calculate the friction tensor from data previously 
calculated with <a class="reference external" href="https://aimsclub.fhi-berlin.mpg.de/">FHI-Aims</a>.
We do this for CO adsorbed at a top site of a Pd(111) surface. The corresponding 
friction tensor is a (6x6) matrix.</p>
<p>In order to run this example you need to download the FHI-Aims dataset 
from following URL and extract it in the example folder</p>
<p><a class="reference external" href="http://www.damaurer.at/software/coolvib/example1.tar.gz">Download Dataset</a></p>
<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1">#    This file is part of coolvib</span>
<span class="c1">#</span>
<span class="c1">#        coolvib is free software: you can redistribute it and/or modify</span>
<span class="c1">#        it under the terms of the GNU General Public License as published by</span>
<span class="c1">#        the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">#        (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1">#        coolvib is distributed in the hope that it will be useful,</span>
<span class="c1">#        but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#        GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#        You should have received a copy of the GNU General Public License</span>
<span class="c1">#        along with coolvib.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">We calculate the (6x6) friction tensor for </span>
<span class="sd">a CO molecule adsorbed on a Pd(111) top site.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ase.io</span> <span class="kn">import</span> <span class="n">read</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">coolvib</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">LA</span>
<span class="c1">#from ase.visualize import view</span>

<span class="c1">#####DEFINE SYSTEM and PARAMETERS######</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="s1">&#39;CO_on_Pd111/eq/geometry.in&#39;</span><span class="p">)</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">system</span>
<span class="n">active_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="c1"># meaning we have two atoms - C - 0 and O - 1</span>
<span class="c1">#view(system)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">coolvib</span><span class="o">.</span><span class="n">workflow_tensor</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s1">&#39;aims&#39;</span><span class="p">,</span> <span class="n">active_atoms</span><span class="o">=</span><span class="n">active_atoms</span><span class="p">)</span>

<span class="n">finite_difference_incr</span> <span class="o">=</span> <span class="mf">0.0025</span>

<span class="n">keywords</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;discretization_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>
    <span class="s1">&#39;discretization_broadening&#39;</span> <span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="s1">&#39;discretization_length&#39;</span> <span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="s1">&#39;max_energy&#39;</span> <span class="p">:</span> <span class="mf">3.00</span><span class="p">,</span>
    <span class="s1">&#39;temperature&#39;</span> <span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
    <span class="s1">&#39;delta_function_type&#39;</span><span class="p">:</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>
    <span class="s1">&#39;delta_function_width&#39;</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">,</span>
    <span class="s1">&#39;perturbing_energy&#39;</span> <span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>

<span class="k">print</span> <span class="s1">&#39;workflow initialized and keywords set&#39;</span>

<span class="c1">######READ QM INPUT DATA###</span>
<span class="n">model</span><span class="o">.</span><span class="n">read_input_data</span><span class="p">(</span>
        <span class="n">spin</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
        <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./CO_on_Pd111/&#39;</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;aims.out&#39;</span><span class="p">,</span> 
        <span class="n">active_atoms</span><span class="o">=</span><span class="n">active_atoms</span><span class="p">,</span> 
        <span class="n">incr</span><span class="o">=</span><span class="n">finite_difference_incr</span><span class="p">,</span>
        <span class="n">debug</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
<span class="k">print</span> <span class="s1">&#39;successfully read QM input data&#39;</span>

<span class="c1">############</span>
<span class="c1">#We can either calculate the spectral function and evaluate friction </span>
<span class="c1">#from there (discretization commands)</span>

<span class="c1">######CALCULATE SPECTRAL FUNCTION###</span>
<span class="c1"># model.calculate_spectral_function(mode=&#39;default&#39;, **keywords)</span>
<span class="c1"># # model.read_spectral_function()</span>
<span class="c1"># print &#39;successfully calculated spectral_function&#39;</span>
<span class="c1"># model.print_spectral_function(&#39;nacs-spectrum.out&#39;)</span>
<span class="c1"># model.calculate_friction_tensor_from_spectrum(**keywords)</span>
<span class="c1"># model.plot_spectral_function()</span>

<span class="c1">#######CALCULATE FRICTION TENSOR###</span>

<span class="c1">#or we directly calculate friction</span>
<span class="n">model</span><span class="o">.</span><span class="n">calculate_friction_tensor</span><span class="p">(</span> <span class="o">**</span><span class="n">keywords</span><span class="p">)</span>

<span class="k">print</span> <span class="s1">&#39;successfully calculated friction tensor&#39;</span>

<span class="n">model</span><span class="o">.</span><span class="n">analyse_friction_tensor</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">print_jmol_friction_eigenvectors</span><span class="p">()</span>


<span class="c1">######project lifetimes along vibrations</span>
<span class="n">hessian_modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;CO_on_Pd111/hessian&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hessian_modes</span><span class="p">)):</span>
    <span class="n">hessian_modes</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">/=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">hessian_modes</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>

<span class="kn">from</span> <span class="nn">coolvib.constants</span> <span class="kn">import</span> <span class="n">time_to_ps</span>
<span class="n">ft</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">hessian_modes</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">friction_tensor</span><span class="p">,</span><span class="n">hessian_modes</span><span class="o">.</span><span class="n">transpose</span><span class="p">()))</span><span class="o">/</span><span class="n">time_to_ps</span>
<span class="n">E</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">ft</span><span class="p">)</span>
<span class="n">coolvib</span><span class="o">.</span><span class="n">routines</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">print_matrix</span><span class="p">(</span><span class="n">ft</span><span class="p">)</span>

<span class="k">print</span> <span class="s1">&#39;Relaxation rates along vibrational modes in 1/ps&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ft</span><span class="p">)):</span>
    <span class="k">print</span> <span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
<span class="k">print</span> <span class="s1">&#39;Vibrational lifetimes along vibrational modes in 1/ps&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ft</span><span class="p">)):</span>
    <span class="k">print</span> <span class="mf">1.</span><span class="o">/</span><span class="n">ft</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>

</pre></div>
</div>
</div>
<div class="section" id="detailed-explanation">
<h2>Detailed Explanation<a class="headerlink" href="#detailed-explanation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="system-setup">
<h3>System Setup<a class="headerlink" href="#system-setup" title="Permalink to this headline">¶</a></h3>
<p>We start by setting up the system using an <a class="reference external" href="https://wiki.fysik.dtu.dk/ase/ase/atoms.html#module-ase.atoms">ASE atoms object</a>
and we initialize our workflow_tensor class with</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">coolvib</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">coolvib</span><span class="o">.</span><span class="n">workflow_tensor</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s1">&#39;aims&#39;</span><span class="p">,</span> <span class="n">active_atoms</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<p>, where <em>active_atoms</em> specifies the indices of the atoms we want to include in 
the calculation of the friction tensor. <em>Model</em> is an instance of the <code class="xref py py-class docutils literal"><span class="pre">coolvib.convenience.workflow_tensor.workflow_tensor</span></code> class that guides us through the calculation and bundles all data and functions.</p>
</div>
<div class="section" id="reading-input-data">
<h3>Reading input data<a class="headerlink" href="#reading-input-data" title="Permalink to this headline">¶</a></h3>
<p>After defining all keywords we can read the FHI-Aims data by 
using <code class="xref py py-func docutils literal"><span class="pre">coolvib.convenience.workflow_tensor.workflow_tensor.read_input_data()</span></code>.</p>
<p>The parser assumes that the input data is given as a set of directories with <em>eq</em> refering 
to the calculation at equilibrium position and <em>a3c0+</em> or <em>a3c0-</em> refering to displacements 
in positive and negative directions for atom3 and the cartesian x component (c0 = x, c1 = y, c2 = z).</p>
</div>
<div class="section" id="calculating-the-spectral-function">
<h3>Calculating the spectral function<a class="headerlink" href="#calculating-the-spectral-function" title="Permalink to this headline">¶</a></h3>
<p>This is an optional step when calculating the friction tensor and at the moment only serves analysis purposes.</p>
<p>Using <code class="xref py py-func docutils literal"><span class="pre">coolvib.convenience.workflow_tensor.workflow_tensor.calculate_spectral_function()</span></code> we can calculate the spectral functions along all cartesian components and all combinations of cartesian components. This includes loops over all possible excitations and construction of the electron-phonon spectral function on a discrete grid. This discretization is determined by following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt><em>discretization_type</em></dt>
<dd>Specifies which broadening function is used to discretize the individual excitations, for more details see <code class="xref py py-func docutils literal"><span class="pre">coolvib.routines.discretize_peak()</span></code></dd>
<dt><em>discretization_broadening</em></dt>
<dd>Specifies the width that is used to generate a finite width discrete representation of the peak and intensity (in eV)</dd>
<dt><em>discretization_length</em></dt>
<dd>Specifies the bin width of equidistant grid on which the spectral function is represented (in eV).</dd>
<dt><em>max_energy</em></dt>
<dd>Specifies the maximum extend beyond the fermi level for which the spectral function is calculated. The default is 3 eV. A safe value is 5 times the delta_function_width+perturbing_energy</dd>
</dl>
</div></blockquote>
<p>The calculated spectral functions can be printed to file using <code class="xref py py-func docutils literal"><span class="pre">coolvib.convenience.workflow_tensor.workflow_tensor.print_spectral_function()</span></code>. This file can be post-processed and further analyzed using scripts from <code class="xref py py-mod docutils literal"><span class="pre">coolvib.tools</span></code>.</p>
<a class="reference internal image-reference" href="_images/spectrum.png"><img alt="_images/spectrum.png" class="align-center" src="_images/spectrum.png" style="width: 85%;" /></a>
</div>
<div class="section" id="calculating-the-friction-tensor-and-analysis">
<h3>Calculating the friction tensor and analysis<a class="headerlink" href="#calculating-the-friction-tensor-and-analysis" title="Permalink to this headline">¶</a></h3>
<p>In order to finally arrive at the friction tensor one either has to integrate the spectral functions 
over a delta function (see <code class="xref py py-func docutils literal"><span class="pre">coolvib.routines.evaluate_delta_function()</span></code>). This is where the 
main approximations of the underlying method are applied. The width, position and shape of the 
delta function are controlled by following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt><em>delta_function_type</em></dt>
<dd>Specifies the type of delta function representation to be used</dd>
<dt><em>delta_function_width</em></dt>
<dd>Specifies the width of the delta function representation (in eV)</dd>
<dt><em>perturbing_energy</em></dt>
<dd>Specifies the position of the delta function representation. Typically this is chosen to be at the Fermi level under the quasi-static approximation (see <a class="reference internal" href="methods.html#theory"><span>Theory</span></a>)</dd>
</dl>
</div></blockquote>
<p>Convergence with respect to the decay rates and lifetimes has to be validated for the above parameters.</p>
<p>The function <code class="xref py py-func docutils literal"><span class="pre">coolvib.convenience.workflow_tensor.workflow_tensor.calculate_friction_tensor_from_spectrum()</span></code> performs this integration and sets up the tensor.</p>
<p>One can directly calculate the friction tensor by using <code class="xref py py-func docutils literal"><span class="pre">coolvib.convenience.workflow_tensor.calculate_friction_tensor()</span></code>, as it is done in this example</p>
<p>Analysis and printing of the tensor, its eigenvalues and eigenfunctions as well as the inverse of the eigenvalues (the principal lifetimes) can be done using <code class="xref py py-func docutils literal"><span class="pre">coolvib.convenience.workflow_tensor.workflow_tensor.analyse_friction_tensor()</span></code>.</p>
</div>
<div class="section" id="results">
<h3>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h3>
<p>The expected results are</p>
<p>Friction Tensor</p>
<blockquote>
<div><blockquote>
<div>0                     1                     2                     3                     4                     5</div></blockquote>
<p>0 3.2947e-01 -5.1951e-05 -1.4243e-04 -9.7699e-02 2.4844e-05 -1.1275e-04 
1 -5.1951e-05 3.2955e-01 -1.4646e-04 1.2838e-05 -9.7716e-02 -1.1241e-04 
2 -1.4243e-04 -1.4646e-04 1.6286e-01 4.2497e-05 4.2755e-05 -1.1424e-02 
3 -9.7699e-02 1.2838e-05 4.2497e-05 2.9649e-02 -5.7152e-06 2.9358e-05 
4 2.4844e-05 -9.7716e-02 4.2755e-05 -5.7152e-06 2.9654e-02 3.0400e-05 
5 -1.1275e-04 -1.1241e-04 -1.1424e-02 2.9358e-05 3.0400e-05 6.7262e-03</p>
</div></blockquote>
<dl class="docutils">
<dt>Friction Eigenvalues in 1/ps</dt>
<dd><blockquote class="first">
<div>0          1          2          3          4          5</div></blockquote>
<p class="last">0.0006     0.0006     0.0059     0.1637     0.3585     0.3586</p>
</dd>
</dl>
<p>Friction Eigenvectors</p>
<blockquote>
<div><blockquote>
<div>0                     1                     2                     3                     4                     5</div></blockquote>
<p>0 -2.7421e-01 -7.6918e-02 -1.3190e-04 6.8885e-04 -8.5161e-01 4.4006e-01 
1 7.6930e-02 -2.7419e-01 -1.8838e-04 7.0623e-04 -4.4007e-01 -8.5161e-01 
2 -3.7931e-05 -5.5541e-05 -7.2589e-02 9.9736e-01 1.0090e-03 3.3623e-04 
3 -9.2294e-01 -2.5899e-01 8.2028e-04 -2.0170e-04 2.5301e-01 -1.3073e-01 
4 2.5899e-01 -9.2295e-01 6.3231e-04 -2.1305e-04 1.3071e-01 2.5300e-01 
5 -5.7038e-04 -7.3214e-04 -9.9736e-01 -7.2590e-02 4.1327e-04 1.3106e-04</p>
</div></blockquote>
<dl class="docutils">
<dt>Principal lifetimes in ps</dt>
<dd><blockquote class="first">
<div>0          1          2          3          4          5</div></blockquote>
<p class="last">1605.4274  1597.3460   169.6452     6.1092     2.7896     2.7885</p>
</dd>
</dl>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html"> Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="methods.html"> Theory and Methods</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html"> Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Example 1: Calculating the friction tensor from FHI-aims</a></li>
<li class="toctree-l2"><a class="reference internal" href="example2.html">Example 2: Calculating lifetimes along a given normal mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="example3.html">Example 3: Setting up finite difference calculations for Example 1 and Example 2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="coolvib.html"> Coolvib: Modules and Classes</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
            <p class="searchtip" style="font-size: 90%">
                Enter search terms or a module, class or function name.
            </p>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="tutorial.html" title="Tutorial"
              >previous</a> |
            <a href="example2.html" title="Example 2: Calculating the lifetime along a given mode: CO on Pd(111)"
              >next</a> |
            <a href="py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/example1.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Reinhard J. Maurer.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>